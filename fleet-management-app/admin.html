<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleet Admin Dashboard</title>
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#fff;
      --muted:#6b7280;
      --accent:#2563eb;
      --danger:#ef4444;
      --ok:#10b981;
      --shadow: 0 6px 20px rgba(15,23,42,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:var(--bg);
      color:#111827;
    }

    /* Layout */
    header{
      background:#ffffff;
      border-bottom:1px solid #e6e9ef;
      padding:12px 18px;
      display:flex;
      align-items:center;
      gap:18px;
      justify-content:space-between;
    }
    header .brand{font-weight:700}
    .filters{display:flex;gap:10px;align-items:center}
    select, button {
      padding:8px 10px;border-radius:8px;border:1px solid #d1d5db;background:white;font-size:14px;
    }
    button.primary{background:var(--accent);color:#fff;border:none}
    button.ghost{background:transparent}
    main {
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:20px;
      padding:20px;
      max-width:1200px;margin:18px auto;
    }

    /* Sidebar form */
    .card{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
      border:1px solid #e6e9ef;
    }
    label{display:block;font-size:13px;margin-bottom:6px;color:#374151}
    input[type="text"], select, input[type="search"] {
      width:100%;padding:9px;border-radius:8px;border:1px solid #d1d5db;margin-bottom:12px;font-size:14px;
    }
    .small{font-size:13px;color:var(--muted)}

    /* Main content */
    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(260px,1fr));
      gap:16px;
    }
    .fleet-card{
      background:#fff;border-radius:10px;padding:12px;border:1px solid #e6e9ef;
      box-shadow: 0 6px 18px rgba(15,23,42,0.04);
      display:flex;flex-direction:column;gap:10px;
    }
    .fleet-top{display:flex;gap:10px;align-items:center}
    .thumb{
      width:80px;height:56px;border-radius:6px;object-fit:cover;border:1px solid #e6e9ef;
      background:#f3f4f6;display:block;
    }
    .meta{flex:1}
    .meta b{display:block}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 8px;border-radius:8px;border:1px solid #e6e9ef;font-size:13px}
    .availability{font-weight:700}
    .avail-yes{color:var(--ok)}
    .avail-no{color:var(--danger)}

    .actions{display:flex;gap:8px}
    .actions button{flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db;background:#fff;cursor:pointer}
    .actions button.update{background:#eef2ff;border-color:#dbeafe;color:var(--accent)}
    .actions button.toggle{background:#ffffff}
    .actions button.delete{background:#fff;border-color:#fee2e2;color:var(--danger)}

    footer{max-width:1200px;margin:0 auto;padding:12px 20px;color:var(--muted);font-size:13px}
    @media (max-width:880px){
      main{grid-template-columns:1fr; padding:12px}
      .thumb{width:64px;height:44px}
    }
  </style>
</head>
<body>

<header>
  <div style="display:flex;gap:14px;align-items:center">
    <div class="brand">Fleet Admin</div>
    <div class="small">Manage vehicles</div>
  </div>

  <div class="filters" role="navigation" aria-label="filters">
    <label class="small" for="filterCategory">Category</label>
    <select id="filterCategory">
      <option value="All">All</option>
      <option value="Auto">Auto</option>
      <option value="Car">Car</option>
      <option value="Truck">Truck</option>
      <option value="Bus">Bus</option>
    </select>

    <label class="small" for="filterAvail">Availability</label>
    <select id="filterAvail">
      <option value="All">All</option>
      <option value="Available">Available</option>
      <option value="Unavailable">Unavailable</option>
    </select>

    <button id="clearFilter" class="ghost">Clear Filter</button>
  </div>
</header>

<main>
  <!-- Sidebar -->
  <aside class="card" aria-labelledby="fleetFormTitle">
    <h3 id="fleetFormTitle" style="margin:0 0 8px">Sidebar — Fleet Form</h3>
    <p class="small" style="margin:0 0 12px">Add a vehicle to the fleet. Required fields: Reg No, Category, Driver Name.</p>

    <form id="fleetForm" onsubmit="return false;">
      <label for="regNo">Reg No of Vehicle</label>
      <input id="regNo" type="text" placeholder="e.g. KA01AB1234" required />

      <label for="category">Category</label>
      <select id="category" required>
        <option value="">-- Select category --</option>
        <option>Auto</option>
        <option>Car</option>
        <option>Truck</option>
        <option>Bus</option>
      </select>

      <label for="driver">Driver Name</label>
      <input id="driver" type="text" placeholder="Driver full name" required />

      <label for="isAvailable">Availability</label>
      <select id="isAvailable">
        <option value="Available">Available</option>
        <option value="Unavailable">Unavailable</option>
      </select>

      <div style="margin-top:10px">
        <button id="addFleet" class="primary" type="button">Add Fleet</button>
      </div>
    </form>
  </aside>

  <!-- Main content -->
  <section>
    <div class="card" style="margin-bottom:14px;display:flex;justify-content:space-between;align-items:center">
      <div>
        <h3 style="margin:0 0 6px">Main Content — Fleet Cards</h3>
        <div class="small">Cards show reg no, category, driver, availability and action buttons.</div>
      </div>
      <div class="small">Maintain 3 cards per row (responsive)</div>
    </div>

    <div id="cardsGrid" class="grid" aria-live="polite"></div>
  </section>
</main>

<footer>
  Tip: Use the Update Driver button to change driver name (prompt). A blank prompt will not update. Delete asks for confirmation.
</footer>

<script>
  (function(){
    const LS_KEY = 'fleets_v1';
    const sampleImage = 'https://images.unsplash.com/photo-1542362567-b07e54358753?w=800&q=60&auto=format&fit=crop&s=sample';

    // DOM
    const regNoEl = document.getElementById('regNo');
    const categoryEl = document.getElementById('category');
    const driverEl = document.getElementById('driver');
    const availEl = document.getElementById('isAvailable');
    const addBtn = document.getElementById('addFleet');
    const grid = document.getElementById('cardsGrid');
    const filterCategory = document.getElementById('filterCategory');
    const filterAvail = document.getElementById('filterAvail');
    const clearFilterBtn = document.getElementById('clearFilter');

    // load from localStorage or sample initial data
    let fleets = load();

    function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw){
          // sample initial set
          const initial = [
            { id: genId(), reg: 'KA01AB1234', category: 'Car', driver: 'Ravi Kumar', available: 'Available' },
            { id: genId(), reg: 'MH02CD4321', category: 'Truck', driver: 'Suresh', available: 'Unavailable' },
            { id: genId(), reg: 'DL5CXY9999', category: 'Bus', driver: 'Priya', available: 'Available' }
          ];
          localStorage.setItem(LS_KEY, JSON.stringify(initial));
          return initial;
        }
        return JSON.parse(raw) || [];
      }catch(e){
        return [];
      }
    }

    function save(){
      localStorage.setItem(LS_KEY, JSON.stringify(fleets));
    }

    function genId(){ return 'id_' + Math.random().toString(36).slice(2,9); }

    // Render cards according to filters
    function render(){
      // apply filters
      const cat = filterCategory.value;
      const av = filterAvail.value;

      const filtered = fleets.filter(f=>{
        if(cat !== 'All' && f.category !== cat) return false;
        if(av !== 'All' && f.available !== av) return false;
        return true;
      });

      grid.innerHTML = '';
      if(filtered.length === 0){
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = '<div class="small">No vehicles to display.</div>';
        grid.appendChild(el);
        return;
      }

      filtered.forEach(f => {
        const card = document.createElement('div');
        card.className = 'fleet-card';
        card.dataset.id = f.id;

        card.innerHTML = `
          <div class="fleet-top">
            <img class="thumb" src="${sampleImage}" alt="vehicle image" />
            <div class="meta">
              <b>${escapeHtml(f.reg)}</b>
              <div class="small">${escapeHtml(f.category)}</div>
              <div style="margin-top:6px" class="small">Driver: <span class="driver-name">${escapeHtml(f.driver)}</span></div>
            </div>
          </div>

          <div class="chips">
            <div class="chip availability">Status: <span class="${f.available==='Available'?'avail-yes':'avail-no'}"> ${f.available}</span></div>
            <a class="small" href="${sampleImage}" target="_blank" rel="noopener" style="text-decoration:none;padding:6px 8px;border:1px solid #e6e9ef;border-radius:8px">Sample Vehicle Link</a>
          </div>

          <div class="actions">
            <button class="update" data-action="update">Update Driver</button>
            <button class="toggle" data-action="toggle">${f.available==='Available'?'Make Unavailable':'Make Available'}</button>
            <button class="delete" data-action="delete">Delete Vehicle</button>
          </div>
        `;

        // attach listeners
        const updateBtn = card.querySelector('button[data-action="update"]');
        const toggleBtn = card.querySelector('button[data-action="toggle"]');
        const deleteBtn = card.querySelector('button[data-action="delete"]');

        updateBtn.addEventListener('click', ()=> onUpdateDriver(f.id));
        toggleBtn.addEventListener('click', ()=> onToggleAvailability(f.id));
        deleteBtn.addEventListener('click', ()=> onDeleteVehicle(f.id));

        grid.appendChild(card);
      });
    }

    // Add fleet
    addBtn.addEventListener('click', ()=>{
      const reg = (regNoEl.value || '').trim();
      const category = (categoryEl.value || '').trim();
      const driver = (driverEl.value || '').trim();
      const available = (availEl.value || 'Available').trim();

      // Validation
      if(!reg){
        alert('Reg No is required.');
        regNoEl.focus();
        return;
      }
      if(!category){
        alert('Please select a category.');
        categoryEl.focus();
        return;
      }
      if(!driver){
        alert('Driver Name is required.');
        driverEl.focus();
        return;
      }

      // Append
      const newVehicle = { id: genId(), reg, category, driver, available };
      fleets.unshift(newVehicle); // add to front
      save();
      render();

      // Clear form
      regNoEl.value = '';
      categoryEl.value = '';
      driverEl.value = '';
      availEl.value = 'Available';
      regNoEl.focus();
    });

    // Update driver - prompt, do not update on empty or whitespace-only
    function onUpdateDriver(id){
      const idx = fleets.findIndex(x=>x.id===id);
      if(idx === -1) return;
      const current = fleets[idx];
      const newName = prompt('Enter new driver name:', current.driver);
      if(newName === null) {
        // user cancelled
        return;
      }
      const trimmed = newName.trim();
      if(trimmed === ''){
        alert('Driver name cannot be empty.');
        return;
      }
      fleets[idx].driver = trimmed;
      save();
      render();
    }

    // Toggle availability
    function onToggleAvailability(id){
      const idx = fleets.findIndex(x=>x.id===id);
      if(idx === -1) return;
      fleets[idx].available = fleets[idx].available === 'Available' ? 'Unavailable' : 'Available';
      save();
      render();
    }

    // Delete vehicle with confirm
    function onDeleteVehicle(id){
      const idx = fleets.findIndex(x=>x.id===id);
      if(idx === -1) return;
      const ok = confirm('Are you sure you want to delete this vehicle?');
      if(!ok) return;
      fleets.splice(idx,1);
      save();
      render();
    }

    // Filters
    filterCategory.addEventListener('change', render);
    filterAvail.addEventListener('change', render);
    clearFilterBtn.addEventListener('click', ()=>{
      filterCategory.value = 'All';
      filterAvail.value = 'All';
      render();
    });

    // helper escape to avoid accidental HTML injection
    function escapeHtml(s){
      return String(s||'').replace(/[&<>"']/g, function(m){
        return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
      });
    }

    // initial render
    render();
  })();
</script>

</body>
</html>
